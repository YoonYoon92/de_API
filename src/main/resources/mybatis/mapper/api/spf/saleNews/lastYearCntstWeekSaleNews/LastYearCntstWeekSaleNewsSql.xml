<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.saydept.api.spf.saleNews.lastYearCntstWeekSaleNews.LastYearCntstWeekSaleNewsMapper">

	<!--
		mybatis-config.xml text copy
		<typeAlias alias="lastYearCntstWeekSaleNewsModel" type="com.saydept.api.spf.saleNews.lastYearCntstWeekSaleNews.model.LastYearCntstWeekSaleNewsModel"/>
	-->
	<!-- 단일 조회 -->
	<select id="selectLastYearCntstWeekSaleNews" resultType="com.saydept.api.spf.saleNews.lastYearCntstWeekSaleNews.model.LastYearCntstWeekSaleNewsModel" parameterType="com.saydept.api.spf.saleNews.lastYearCntstWeekSaleNews.model.LastYearCntstWeekSaleNewsModel">
		/*selectLastYearCntstWeekSaleNews*/
		SELECT ...
	</select>

	<!-- 목록조회 fetchSize="1000" 옵션은 많은 수의 데이터를 조회 할 때 한번에 읽어들일  크기  -->
	<select id="selectLastYearCntstWeekSaleNewsList" resultType="com.saydept.api.spf.saleNews.lastYearCntstWeekSaleNews.model.LastYearCntstWeekSaleNewsModel" parameterType="com.saydept.api.spf.saleNews.lastYearCntstWeekSaleNews.model.LastYearCntstWeekSaleNewsParamModel" fetchSize="1000">
		/*selectLastYearCntstWeekSaleNewsList*/
		
		
		WITH 
	
		/**
		 * 일 목표
		 */
		TA01GOAL AS ( 
		SELECT 	'01' AS NO1, 
				'목표' AS DIVISION, 
				SUM(CASE WHEN IS05101=#{d6Day}     THEN IS05106*1000 ELSE 0 END) AS DAYGOALD_6,
				SUM(CASE WHEN IS05101=#{d5Day}     THEN IS05106*1000 ELSE 0 END) AS DAYGOALD_5,
				SUM(CASE WHEN IS05101=#{d4Day}     THEN IS05106*1000 ELSE 0 END) AS DAYGOALD_4,
				SUM(CASE WHEN IS05101=#{d3Day}     THEN IS05106*1000 ELSE 0 END) AS DAYGOALD_3,
				SUM(CASE WHEN IS05101=#{d2Day}     THEN IS05106*1000 ELSE 0 END) AS DAYGOALD_2,
				SUM(CASE WHEN IS05101=#{d1Day}     THEN IS05106*1000 ELSE 0 END) AS DAYGOALD_1,
				SUM(CASE WHEN IS05101=#{startDate} THEN IS05106*1000 ELSE 0 END) AS DAYGOALD
		FROM	${dbType}SPFRDB.SPFI05PF1
		WHERE 	IS05101 &lt;= #{startDate}        
		AND     IS05101 &gt;= #{d6Day}            
		AND 	IS05102 = #{jum}                  
		<if test="bu != null and bu !=''">        
		AND 	IS05103 = SUBSTR(#{bu},3,2)          
		</if>                                     
		<if test="tim != null and tim !=''">      
		AND 	IS05104 = SUBSTR(#{tim},5,2)
		</if>                                     
		GROUP BY '01', '목표'                       
		)

		/**
		 * 실적
		 */
		,
		TA01PERFORM AS ( 
		SELECT 	'02' AS NO1, 
				'실적' AS DIVISION, 
				SUM(CASE WHEN IS5201=#{d6Day}     THEN IS5213 ELSE 0 END) AS DAYSALEAMOUNTD_6,
				SUM(CASE WHEN IS5201=#{d5Day}     THEN IS5213 ELSE 0 END) AS DAYSALEAMOUNTD_5,
				SUM(CASE WHEN IS5201=#{d4Day}     THEN IS5213 ELSE 0 END) AS DAYSALEAMOUNTD_4,
				SUM(CASE WHEN IS5201=#{d3Day}     THEN IS5213 ELSE 0 END) AS DAYSALEAMOUNTD_3,
				SUM(CASE WHEN IS5201=#{d2Day}     THEN IS5213 ELSE 0 END) AS DAYSALEAMOUNTD_2,
				SUM(CASE WHEN IS5201=#{d1Day}     THEN IS5213 ELSE 0 END) AS DAYSALEAMOUNTD_1,
				SUM(CASE WHEN IS5201=#{startDate} THEN IS5213 ELSE 0 END) AS DAYSALEAMOUNTD
		FROM	${dbType}SPFRDB.SPFI52PF
		WHERE 	IS5201 &lt;= #{startDate}    
		AND     IS5201 &gt;= #{d6Day}        
		AND 	IS5203 = #{jum}                 
		<if test="bu != null and bu !=''">      
		AND 	IS5204 = SUBSTR(#{bu},3,2)          
		</if>                                   
		<if test="tim != null and tim !=''">    
		AND 	IS5205 = SUBSTR(#{tim},5,2) 
		</if>                                   
		GROUP BY '02', '실적'                   
		
		)
		
		
		/**
		 * 실적 - 목표 차액
		 */
		,
		TA01DIFF AS (
		SELECT 	'03' AS NO1,
				'차액' AS DIVISION,
				TA01PERFORM.DAYSALEAMOUNTD_6-TA01GOAL.DAYGOALD_6 AS DIFFD_6,
				TA01PERFORM.DAYSALEAMOUNTD_5-TA01GOAL.DAYGOALD_5 AS DIFFD_5,
				TA01PERFORM.DAYSALEAMOUNTD_4-TA01GOAL.DAYGOALD_4 AS DIFFD_4,
				TA01PERFORM.DAYSALEAMOUNTD_3-TA01GOAL.DAYGOALD_3 AS DIFFD_3,
				TA01PERFORM.DAYSALEAMOUNTD_2-TA01GOAL.DAYGOALD_2 AS DIFFD_2,
				TA01PERFORM.DAYSALEAMOUNTD_1-TA01GOAL.DAYGOALD_1 AS DIFFD_1,
				TA01PERFORM.DAYSALEAMOUNTD  -TA01GOAL.DAYGOALD   AS DIFFD
		FROM 	TA01PERFORM, TA01GOAL
		)
		
		/**
		 * 일 달성율
		 */
		,
		TA01ATT AS (
		SELECT 	'04' AS NO1,
				'달성율' AS DIVISION,
				FLOAT(TA01PERFORM.DAYSALEAMOUNTD_6) /FLOAT(TA01GOAL.DAYGOALD_6)*100 AS ACHIVERAT_6,
				FLOAT(TA01PERFORM.DAYSALEAMOUNTD_5) /FLOAT(TA01GOAL.DAYGOALD_5)*100 AS ACHIVERAT_5,
				FLOAT(TA01PERFORM.DAYSALEAMOUNTD_4) /FLOAT(TA01GOAL.DAYGOALD_4)*100 AS ACHIVERAT_4,
				FLOAT(TA01PERFORM.DAYSALEAMOUNTD_3) /FLOAT(TA01GOAL.DAYGOALD_3)*100 AS ACHIVERAT_3,
				FLOAT(TA01PERFORM.DAYSALEAMOUNTD_2) /FLOAT(TA01GOAL.DAYGOALD_2)*100 AS ACHIVERAT_2,
				FLOAT(TA01PERFORM.DAYSALEAMOUNTD_1) /FLOAT(TA01GOAL.DAYGOALD_1)*100 AS ACHIVERAT_1,
				FLOAT(TA01PERFORM.DAYSALEAMOUNTD  ) /FLOAT(TA01GOAL.DAYGOALD  )*100 AS ACHIVERAT
		FROM 	TA01PERFORM, TA01GOAL
		)    
		
		/**
		 * 고객수
		 */
		,
		TA01CUST AS (
		SELECT 	'05' AS NO1,
				'고객수' AS DIVISION,
				SUM(CASE WHEN IS5201=#{d6Day}     THEN IS5216 ELSE 0 END) AS DAYCUSTOMCNT_6,
				SUM(CASE WHEN IS5201=#{d5Day}     THEN IS5216 ELSE 0 END) AS DAYCUSTOMCNT_5,
				SUM(CASE WHEN IS5201=#{d4Day}     THEN IS5216 ELSE 0 END) AS DAYCUSTOMCNT_4,
				SUM(CASE WHEN IS5201=#{d3Day}     THEN IS5216 ELSE 0 END) AS DAYCUSTOMCNT_3,
				SUM(CASE WHEN IS5201=#{d2Day}     THEN IS5216 ELSE 0 END) AS DAYCUSTOMCNT_2,
				SUM(CASE WHEN IS5201=#{d1Day}     THEN IS5216 ELSE 0 END) AS DAYCUSTOMCNT_1,
				SUM(CASE WHEN IS5201=#{startDate} THEN IS5216 ELSE 0 END) AS DAYCUSTOMCNT
		FROM	${dbType}SPFRDB.SPFI52PF 
		WHERE 	IS5201 &lt;= #{startDate}       
		AND     IS5201 &gt;= #{d6Day}           
		AND 	IS5203 = #{jum}                 
		<if test="bu != null and bu !=''">      
		AND 	IS5204 = SUBSTR(#{bu},3,2)          
		</if>                                   
		<if test="tim != null and tim !=''">    
		AND 	IS5205 = SUBSTR(#{tim},5,2) 	
		</if> 	
		GROUP BY '05', '고객수'      
		)
		
		/**
		 * 객단가
		 */
		,
		TA01CUSTPRICE AS (
		SELECT 	'06' AS NO1,
				'객단가' AS DIVISION,
				TA01PERFORM.DAYSALEAMOUNTD_6 /TA01CUST.DAYCUSTOMCNT_6  AS CUSTPRICE_6,
				TA01PERFORM.DAYSALEAMOUNTD_5 /TA01CUST.DAYCUSTOMCNT_5  AS CUSTPRICE_5,
				TA01PERFORM.DAYSALEAMOUNTD_4 /TA01CUST.DAYCUSTOMCNT_4  AS CUSTPRICE_4,
				TA01PERFORM.DAYSALEAMOUNTD_3 /TA01CUST.DAYCUSTOMCNT_3  AS CUSTPRICE_3,
				TA01PERFORM.DAYSALEAMOUNTD_2 /TA01CUST.DAYCUSTOMCNT_2  AS CUSTPRICE_2,
				TA01PERFORM.DAYSALEAMOUNTD_1 /TA01CUST.DAYCUSTOMCNT_1  AS CUSTPRICE_1,
				TA01PERFORM.DAYSALEAMOUNTD   /TA01CUST.DAYCUSTOMCNT    AS CUSTPRICE
		FROM 	TA01PERFORM, TA01CUST
		)   
		

		/**
		 * 전년 동요일 목표
		 */
		,
		TA11GOAL AS ( 
		SELECT 	'11' AS NO1, 
				'목표' AS DIVISION, 
				SUM(CASE WHEN IS05101=#{oldD6Day}     THEN IS05106*1000 ELSE 0 END) AS DAYGOALD_6,
				SUM(CASE WHEN IS05101=#{oldD5Day}     THEN IS05106*1000 ELSE 0 END) AS DAYGOALD_5,
				SUM(CASE WHEN IS05101=#{oldD4Day}     THEN IS05106*1000 ELSE 0 END) AS DAYGOALD_4,
				SUM(CASE WHEN IS05101=#{oldD3Day}     THEN IS05106*1000 ELSE 0 END) AS DAYGOALD_3,
				SUM(CASE WHEN IS05101=#{oldD2Day}     THEN IS05106*1000 ELSE 0 END) AS DAYGOALD_2,
				SUM(CASE WHEN IS05101=#{oldD1Day}     THEN IS05106*1000 ELSE 0 END) AS DAYGOALD_1,
				SUM(CASE WHEN IS05101=#{oldStartDate} THEN IS05106*1000 ELSE 0 END) AS DAYGOALD
		FROM	${dbType}SPFRDB.SPFI05PF1                       
		WHERE 	IS05101 &lt;= #{oldStartDate}             
		AND     IS05101 &gt;= #{oldD6Day}                 
		AND 	IS05102 = #{jum}                       
		<if test="bu != null and bu !=''">             
		AND 	IS05103 = SUBSTR(#{bu},3,2)               
		</if>                                          
		<if test="tim != null and tim !=''">           
		AND 	IS05104 = SUBSTR(#{tim},5,2)     
		</if>                                          
		GROUP BY '11', '목표'      
		)
		
		/**
		 * 실적
		 */
		,
		TA11PERFORM AS ( 
		SELECT 	'12' AS NO1, 
				'실적' AS DIVISION, 
				SUM(CASE WHEN IS5201=#{oldD6Day}     THEN IS5213 ELSE 0 END) AS DAYSALEAMOUNTD_6,
				SUM(CASE WHEN IS5201=#{oldD5Day}     THEN IS5213 ELSE 0 END) AS DAYSALEAMOUNTD_5,
				SUM(CASE WHEN IS5201=#{oldD4Day}     THEN IS5213 ELSE 0 END) AS DAYSALEAMOUNTD_4,
				SUM(CASE WHEN IS5201=#{oldD3Day}     THEN IS5213 ELSE 0 END) AS DAYSALEAMOUNTD_3,
				SUM(CASE WHEN IS5201=#{oldD2Day}     THEN IS5213 ELSE 0 END) AS DAYSALEAMOUNTD_2,
				SUM(CASE WHEN IS5201=#{oldD1Day}     THEN IS5213 ELSE 0 END) AS DAYSALEAMOUNTD_1,
				SUM(CASE WHEN IS5201=#{oldStartDate} THEN IS5213 ELSE 0 END) AS DAYSALEAMOUNTD
		FROM	${dbType}SPFRDB.SPFI52PF   
		WHERE 	IS5201 &lt;= #{oldStartDate}   
		AND     IS5201 &gt;= #{oldD6Day}       
		AND 	IS5203 = #{jum}                
		<if test="bu != null and bu !=''">     
		AND 	IS5204 = SUBSTR(#{bu},3,2)         
		</if>                                  
		<if test="tim != null and tim !=''">   
		AND 	IS5205 = SUBSTR(#{tim},5,2)
		</if>                                  
		GROUP BY '12', '실적'                  		
		)
		
		/**
		 * 실적 - 목표 차액
		 */
		,
		TA11DIFF AS (
		SELECT 	'13' AS NO1,
				'차액' AS DIVISION,
				TA11PERFORM.DAYSALEAMOUNTD_6-TA11GOAL.DAYGOALD_6 AS DIFFD_6,
				TA11PERFORM.DAYSALEAMOUNTD_5-TA11GOAL.DAYGOALD_5 AS DIFFD_5,
				TA11PERFORM.DAYSALEAMOUNTD_4-TA11GOAL.DAYGOALD_4 AS DIFFD_4,
				TA11PERFORM.DAYSALEAMOUNTD_3-TA11GOAL.DAYGOALD_3 AS DIFFD_3,
				TA11PERFORM.DAYSALEAMOUNTD_2-TA11GOAL.DAYGOALD_2 AS DIFFD_2,
				TA11PERFORM.DAYSALEAMOUNTD_1-TA11GOAL.DAYGOALD_1 AS DIFFD_1,
				TA11PERFORM.DAYSALEAMOUNTD  -TA11GOAL.DAYGOALD   AS DIFFD
		FROM 	TA11PERFORM, TA11GOAL
		)
		
		/**
		 * 일 달성율
		 */
		,
		TA11ATT AS (
		SELECT 	'14' AS NO1,
				'달성율' AS DIVISION,
				FLOAT(TA11PERFORM.DAYSALEAMOUNTD_6) /FLOAT(TA11GOAL.DAYGOALD_6)*100 AS ACHIVERAT_6,
				FLOAT(TA11PERFORM.DAYSALEAMOUNTD_5) /FLOAT(TA11GOAL.DAYGOALD_5)*100 AS ACHIVERAT_5,
				FLOAT(TA11PERFORM.DAYSALEAMOUNTD_4) /FLOAT(TA11GOAL.DAYGOALD_4)*100 AS ACHIVERAT_4,
				FLOAT(TA11PERFORM.DAYSALEAMOUNTD_3) /FLOAT(TA11GOAL.DAYGOALD_3)*100 AS ACHIVERAT_3,
				FLOAT(TA11PERFORM.DAYSALEAMOUNTD_2) /FLOAT(TA11GOAL.DAYGOALD_2)*100 AS ACHIVERAT_2,
				FLOAT(TA11PERFORM.DAYSALEAMOUNTD_1) /FLOAT(TA11GOAL.DAYGOALD_1)*100 AS ACHIVERAT_1,
				FLOAT(TA11PERFORM.DAYSALEAMOUNTD  ) /FLOAT(TA11GOAL.DAYGOALD  )*100 AS ACHIVERAT
		FROM 	TA11PERFORM, TA11GOAL
		)    
		
		/**
		 * 고객수
		 */
		,
		TA11CUST AS (
		SELECT 	'15' AS NO1,
				'고객수' AS DIVISION,
				SUM(CASE WHEN IS5201=#{oldD6Day}     THEN IS5216 ELSE 0 END) AS DAYCUSTOMCNT_6,
				SUM(CASE WHEN IS5201=#{oldD5Day}     THEN IS5216 ELSE 0 END) AS DAYCUSTOMCNT_5,
				SUM(CASE WHEN IS5201=#{oldD4Day}     THEN IS5216 ELSE 0 END) AS DAYCUSTOMCNT_4,
				SUM(CASE WHEN IS5201=#{oldD3Day}     THEN IS5216 ELSE 0 END) AS DAYCUSTOMCNT_3,
				SUM(CASE WHEN IS5201=#{oldD2Day}     THEN IS5216 ELSE 0 END) AS DAYCUSTOMCNT_2,
				SUM(CASE WHEN IS5201=#{oldD1Day}     THEN IS5216 ELSE 0 END) AS DAYCUSTOMCNT_1,
				SUM(CASE WHEN IS5201=#{oldStartDate} THEN IS5216 ELSE 0 END) AS DAYCUSTOMCNT
		FROM	${dbType}SPFRDB.SPFI52PF 
		WHERE 	IS5201 &lt;= #{oldStartDate}     
		AND     IS5201 &gt;= #{oldD6Day}         
		AND 	IS5203 = #{jum}                  
		<if test="bu != null and bu !=''">       
		AND 	IS5204 = SUBSTR(#{bu},3,2)           
		</if>                                    
		<if test="tim != null and tim !=''">     
		AND 	IS5205 = SUBSTR(#{tim},5,2)  
		</if>                                    
		GROUP BY '15', '고객수' 		
		)
		
		
		/**
		 * 객단가
		 */
		,
		TA11CUSTPRICE AS (
		SELECT 	'16' AS NO1,
				'객단가' AS DIVISION,
				TA11PERFORM.DAYSALEAMOUNTD_6 / TA11CUST.DAYCUSTOMCNT_6  AS CUSTPRICE_6,
				TA11PERFORM.DAYSALEAMOUNTD_5 / TA11CUST.DAYCUSTOMCNT_5  AS CUSTPRICE_5,
				TA11PERFORM.DAYSALEAMOUNTD_4 / TA11CUST.DAYCUSTOMCNT_4  AS CUSTPRICE_4,
				TA11PERFORM.DAYSALEAMOUNTD_3 / TA11CUST.DAYCUSTOMCNT_3  AS CUSTPRICE_3,
			TA11PERFORM.DAYSALEAMOUNTD_2 / TA11CUST.DAYCUSTOMCNT_2  AS CUSTPRICE_2,
				TA11PERFORM.DAYSALEAMOUNTD_1 / TA11CUST.DAYCUSTOMCNT_1  AS CUSTPRICE_1,
				TA11PERFORM.DAYSALEAMOUNTD   / TA11CUST.DAYCUSTOMCNT    AS CUSTPRICE
		FROM 	TA11PERFORM, TA11CUST
		)   
		
		
		
		/**
		 * 전년대비 신장율
		 */
		,
		TA20ELONGATION AS (
		SELECT 	'20' AS NO1,
				'신장율' AS DIVISION,
				(FLOAT(TA01PERFORM.DAYSALEAMOUNTD_6) -FLOAT(TA11PERFORM.DAYSALEAMOUNTD_6))/ABS(FLOAT(TA11PERFORM.DAYSALEAMOUNTD_6))*100 AS STRECHRAT_6,
				(FLOAT(TA01PERFORM.DAYSALEAMOUNTD_5) -FLOAT(TA11PERFORM.DAYSALEAMOUNTD_5))/ABS(FLOAT(TA11PERFORM.DAYSALEAMOUNTD_5))*100 AS STRECHRAT_5,
				(FLOAT(TA01PERFORM.DAYSALEAMOUNTD_4) -FLOAT(TA11PERFORM.DAYSALEAMOUNTD_4))/ABS(FLOAT(TA11PERFORM.DAYSALEAMOUNTD_4))*100 AS STRECHRAT_4,
				(FLOAT(TA01PERFORM.DAYSALEAMOUNTD_3) -FLOAT(TA11PERFORM.DAYSALEAMOUNTD_3))/ABS(FLOAT(TA11PERFORM.DAYSALEAMOUNTD_3))*100 AS STRECHRAT_3,
				(FLOAT(TA01PERFORM.DAYSALEAMOUNTD_2) -FLOAT(TA11PERFORM.DAYSALEAMOUNTD_2))/ABS(FLOAT(TA11PERFORM.DAYSALEAMOUNTD_2))*100 AS STRECHRAT_2,
				(FLOAT(TA01PERFORM.DAYSALEAMOUNTD_1) -FLOAT(TA11PERFORM.DAYSALEAMOUNTD_1))/ABS(FLOAT(TA11PERFORM.DAYSALEAMOUNTD_1))*100 AS STRECHRAT_1,
			    (FLOAT(TA01PERFORM.DAYSALEAMOUNTD)   -FLOAT(TA11PERFORM.DAYSALEAMOUNTD))  /ABS(FLOAT(TA11PERFORM.DAYSALEAMOUNTD))*100   AS STRECHRAT
		FROM 	TA01PERFORM, TA11PERFORM
		)    
		

		
		
		
		/**
		 * 시간대별 속보 화면 union 
		 */
		
		/* 당년 */
		SELECT * FROM TA01GOAL 
    	UNION ALL
		SELECT * FROM TA01PERFORM
		UNION ALL
		SELECT * FROM TA01DIFF
		UNION ALL
		SELECT * FROM TA01ATT
		UNION ALL
		SELECT * FROM TA01CUST
		UNION ALL
		SELECT * FROM TA01CUSTPRICE
		
		/*  전년  */
		UNION ALL
		SELECT * FROM TA11GOAL 
		UNION ALL
		SELECT * FROM TA11PERFORM
		UNION ALL
		SELECT * FROM TA11DIFF
		UNION ALL
		SELECT * FROM TA11ATT
		UNION ALL
		SELECT * FROM TA11CUST
		UNION ALL
		SELECT * FROM TA11CUSTPRICE
		
		/* 신장율 */
		UNION ALL
		SELECT * FROM TA20ELONGATION
		ORDER BY NO1 
		
	</select>

	
</mapper>