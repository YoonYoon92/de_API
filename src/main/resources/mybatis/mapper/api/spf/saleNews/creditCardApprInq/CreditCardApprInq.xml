<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper
	namespace="com.saydept.api.spf.saleNews.creditCardApprInq.CreditCardApprInqMapper">


	<select id="getCreditCardApprInqlist"
		parameterType="com.saydept.api.spf.saleNews.creditCardApprInq.model.CreditCardApprInqParamModel"
		resultType="com.saydept.api.spf.saleNews.creditCardApprInq.model.CreditCardApprInqModel">

SELECT
        SUBSTR(P07PDAT,23,4) regiNo
        ,CASE WHEN MS0510 != '' THEN TRIM(MS0510) ELSE TRIM(PD1806) END regiNm
        ,SUBSTR(P07PDAT,17,6) appTime
        ,SUBSTR(P07PDAT,27,4) appJp
        ,S021RCPT appRcpt
        ,SUBSTR(P07RCVD,248,8) appNo
        ,SUBSTR(P07PDAT,102,2) halBu
        ,SUBSTR(P07RCVD,56,4) rcvNo
        ,SUBSTR(P07PDAT,104,8) appAmt
        --,SUBSTR(P07PDAT,7,2) MAEJUM
        ,'KIS' vanCo
        ,CASE WHEN S02TCDNO != '' THEN 'Y' ELSE ' ' END guBun
        ,TRIM(S40MEMO) s40Memo
        ,SUBSTR(P07RCVD,272,40) vanMemo
FROM ${dbType}SPOTNRDB.SPOIC07
        LEFT OUTER JOIN ${dbType}SCDRDB.SCDS02LF3
        ON S02JUM = P07JUNO AND S02TCDNO = SUBSTRING(P07PDAT,64,16) AND S02MAEY1 = SUBSTR(P07SDATE,1,2) AND S02MAEY2 = SUBSTR(P07SDATE,3,2) AND S02MAEM = SUBSTR(P07SDATE,5,2) AND S02MAED = SUBSTR(P07SDATE,7,2) AND S02APPNO = SUBSTR(P07RCVD,248,8)
        LEFT OUTER JOIN ${dbType}SCDRDB.SCDS02PF1
        ON S021MAEJUM = S02MAEJUM AND S021MAEY1 = S02MAEY1 AND S021MAEY2 = S02MAEY2 AND S021MAEM = S02MAEM AND S021MAED = S02MAED AND S021REGINO = S02REGINO AND S021SLPNO = S02SLPNO
        LEFT OUTER JOIN ${dbType}SCDRDB.SCDS40PF
        ON S40MAEYY = SUBSTR(P07SDATE,1,4) AND S40MAEMD = SUBSTR(P07SDATE,5,4) AND S40CARDNO = SUBSTRING(P07PDAT,64,16) AND S40APPNO = SUBSTR(P07RCVD,248,8) AND S40GUBUN = CASE WHEN SUBSTR(P07PDAT,31,1) = 0 THEN '' ELSE '1' END
        LEFT OUTER JOIN ${dbType}SPORDB.SPOM18PF
        ON PD1801 = P07JUNO AND PD1802 = SUBSTR(P07PDAT,23,4)
        LEFT OUTER JOIN ${dbType}SPORDB.SPOM11LF2
        ON PD1115 = P07JUNO AND PD1104 = SUBSTR(P07PDAT,23,4) AND PD1107 = '' AND PD1110 ='O'
        LEFT OUTER JOIN ${dbType}SPFRDB.SPFM05PF
        ON MS0501 = P07JUNO AND MS0505 = PD1105
WHERE P07JUNO='01'  
		AND P07MMDD = '0929'
        AND P07SDATE = '20200929'

AND SUBSTRING(P07PDAT,64,16) = (CASE WHEN SUBSTRING('402857******4023',15,1) = '=' THEN  SUBSTRING('402857******4023',1,15)||'='
                                     WHEN SUBSTRING('402857******4023',14,1) = '=' THEN  SUBSTRING('402857******4023',1,14)||'= '
                                     ELSE                                                '402857******4023'
                                     END
                              )




UNION ALL


SELECT
        SUBSTR(P09PDAT,23,4) regiNo
        ,CASE WHEN MS0510 != '' THEN TRIM(MS0510) ELSE TRIM(PD1806) END regiNm
        ,SUBSTR(P09PDAT,17,6) appTime
        ,SUBSTR(P09PDAT,27,4) appJp
        ,S021RCPT appRcpt
        ,SUBSTR(P09RCVD,248,8) appNo
        ,SUBSTR(P09PDAT,102,2) halBu
        ,SUBSTR(P09RCVD,56,4) rcvNo
        ,SUBSTR(P09PDAT,104,8) appAmt
        --,SUBSTR(P09PDAT,7,2) MAEJUM
        ,'NICE' vanCo
        ,CASE WHEN S02TCDNO != '' THEN 'Y' ELSE ' ' END guBun
        ,TRIM(S40MEMO) s40Memo
        ,SUBSTR(P09RCVD,272,40) vanMemo
 FROM ${dbType}SPOTNRDB.SPOIC09
        LEFT OUTER JOIN ${dbType}SCDRDB.SCDS02LF3
        ON S02JUM = P09JUNO AND S02TCDNO = SUBSTRING(P09PDAT,64,16) AND S02MAEY1 = SUBSTR(P09SDATE,1,2) AND S02MAEY2 = SUBSTR(P09SDATE,3,2) AND S02MAEM = SUBSTR(P09SDATE,5,2) AND S02MAED = SUBSTR(P09SDATE,7,2) AND S02APPNO = SUBSTR(P09RCVD,248,8)
        LEFT OUTER JOIN ${dbType}SCDRDB.SCDS02PF1
        ON S021MAEJUM = S02MAEJUM AND S021MAEY1 = S02MAEY1 AND S021MAEY2 = S02MAEY2 AND S021MAEM = S02MAEM AND S021MAED = S02MAED AND S021REGINO = S02REGINO AND S021SLPNO = S02SLPNO
        LEFT OUTER JOIN ${dbType}SCDRDB.SCDS40PF
        ON S40MAEYY = SUBSTR(P09SDATE,1,4) AND S40MAEMD = SUBSTR(P09SDATE,5,4) AND S40CARDNO = SUBSTRING(P09PDAT,64,16) AND S40APPNO = SUBSTR(P09RCVD,248,8) AND S40GUBUN = CASE WHEN SUBSTR(P09PDAT,31,1) = 0 THEN '' ELSE '1' END
        LEFT OUTER JOIN ${dbType}SPORDB.SPOM18PF
        ON PD1801 = P09JUNO AND PD1802 = SUBSTR(P09PDAT,23,4)
        LEFT OUTER JOIN ${dbType}SPORDB.SPOM11LF2
        ON PD1115 = P09JUNO AND PD1104 = SUBSTR(P09PDAT,23,4) AND PD1107 = '' AND PD1110 ='O'
        LEFT OUTER JOIN ${dbType}SPFRDB.SPFM05PF
        ON MS0501 = P09JUNO AND MS0505 = PD1105
WHERE P09JUNO='01'
		AND P09MMDD = '0914'
        AND P09SDATE = '20200914'

AND SUBSTRING(P09PDAT,64,16) = (CASE WHEN SUBSTRING('402857******4023',15,1) = '=' THEN  SUBSTRING('402857******4023',1,15)||'='
                                     WHEN SUBSTRING('402857******4023',14,1) = '=' THEN  SUBSTRING('402857******4023',1,14)||'= '
                                     ELSE                                                '402857******4023'
                                     END
                              )




	</select>

</mapper>


